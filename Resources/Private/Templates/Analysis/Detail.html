{namespace core=TYPO3\CMS\Core\ViewHelpers}
<f:layout name="Backend"/>

<f:section name="content">
    <div class="row" data-lux-container="detail">
        <div class="col-md-6">
            <div class="panel panel-default">
                <div class="panel-heading">
                    <h3 class="panel-title">
                        <f:translate key="LLL:EXT:lux/Resources/Private/Language/locallang_db.xlf:module.detail">Preview</f:translate>
                    </h3>
                </div>
                <div class="panel-body">
                    <div class="row">
                        <div class="col-md-3">
                            <img src="{lux:visitor.getGravatarImage(visitor:visitor)}" width="150" style="max-width: 100%; margin-top: 20px;" class="img-circle img-responsive" />
                        </div>
                        <div class="col-md-9">
                            <h3>
                                {visitor.fullName}
                                <span class="badge" title="{f:translate(key:'LLL:EXT:lux/Resources/Private/Language/locallang_db.xlf:tx_lux_domain_model_visitor.scoring')}">{visitor.scoring}</span>
                                <f:if condition="{visitor.identified}"><a href="http://www.google.com/search?q={visitor.fullName}" target="_blank" title="Search on google"><img src="{f:uri.resource(path:'Images/LogoGoogle.svg',extensionName:'Lux')}" width="16" /></a></f:if>
                            </h3>

                            <f:if condition="{visitor.attributes}">
                                <table class="table table-striped table-hover table-condensed">
                                    <f:for each="{visitor.importantAttributes}" as="attribute">
                                        <tr>
                                            <td>{attribute.label}:</td>
                                            <td>{attribute.value}</td>
                                        </tr>
                                    </f:for>
                                    <f:for each="{visitor.unimportantAttributes}" as="attribute">
                                        <tr>
                                            <td>{attribute.label}:</td>
                                            <td>{attribute.value}</td>
                                        </tr>
                                    </f:for>
                                </table>
                            </f:if>

                            <div class="row">
                                <div class="col-md-12">
                                    <textarea class="lux-textarea{f:if(condition:'{visitor.description}',else:' lux-textarea__default')}" data-lux-visitor-description="{visitor.uid}"><f:if condition="{visitor.description}"><f:then>{visitor.description}</f:then><f:else><f:translate key="LLL:EXT:lux/Resources/Private/Language/locallang_db.xlf:module.detail.description">Add text...</f:translate></f:else></f:if></textarea>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-md-12">
                                    <button style="margin-top: 15px" class="btn btn-primary pull-right" data-lux-linkmock-event="detail{visitor.uid}"><f:translate key="LLL:EXT:lux/Resources/Private/Language/locallang_db.xlf:module.detail.linkdetail">show</f:translate></button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>



            <div class="panel panel-default">
                <div class="panel-heading">
                    <h3 class="panel-title">
                        <f:translate key="LLL:EXT:lux/Resources/Private/Language/locallang_db.xlf:module.detail.scoring">Scoring</f:translate>
                    </h3>
                </div>
                <div class="panel-body">
                    <canvas id="detailchart"
                            width="750"
                            height="250"
                            data-chart-data="{lux:charts.getScoringOfTheLastWeeksToAVisitor(visitor:visitor)}"
                            data-chart-label="Scoring"
                            data-chart-labels="{lux:charts.getLastWeekNames()}"></canvas>
                    <script type="application/javascript">
						require(['TYPO3/CMS/Lux/Vendor/Chart.min'], function(Chart) {
							var container = document.getElementById('detailchart');
							var ctx = container.getContext('2d');

							new Chart(ctx, {
								type: 'line',
								data: {
									datasets: [{
										label: container.getAttribute('data-chart-label'),
										data: container.getAttribute('data-chart-data').split(','),
										borderColor: 'rgb(77, 231, 255)',
										"lineTension": 0.5
									}],
									labels: container.getAttribute('data-chart-labels').split(',')
								},
								options: {
									legend: {
										display: false,
										position: 'right',
										labels: {
											fontSize: 18
										}
									},
									scales: {
										yAxes: [{
											ticks: {
												beginAtZero: true
											}
										}]
									}
								}
							});
						});
                    </script>
                </div>
            </div>
        </div>


        <div class="col-md-3">
            <f:alias map="{interestingLogs:visitor.logs}">
                <f:render partial="Analysis/Log" arguments="{_all}" />
            </f:alias>
        </div>


        <div class="col-md-3">
            <f:render partial="Analysis/PageFunnel" arguments="{_all}" />
        </div>
    </div>
    <div class="row">
        <div class="col-md-12">
            <button onclick="window.history.back();" class="btn btn-primary">Go Back</button>
        </div>
    </div>
</f:section>
