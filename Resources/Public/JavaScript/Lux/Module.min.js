define(["jquery","TYPO3/CMS/Lux/Vendor/Chart.min"],function(t){"use strict";function e(t){var e=this;this.initialize=function(){a(),n(),r(),i(),l(),o(),u(),c()};var a=function(){for(var t=document.querySelectorAll("[data-lux-action-detail]"),e=0;e<t.length;e++){var a=t[e];a.addEventListener("click",function(){g(t,"lux-action-detail"),this.classList.add("lux-action-detail");var e=this.getAttribute("data-lux-action-detail");v(TYPO3.settings.ajaxUrls["/lux/detail"],{visitor:e},"showDetailCallback")})}},n=function(){var t=document.querySelector('[data-lux-container="detail"]');null!==t&&t.addEventListener("click",function(t){var e=t.target;if(e.getAttribute("data-lux-visitor-description")>0){e.classList.contains("lux-textarea__default")&&(e.classList.remove("lux-textarea__default"),e.value="");var a=e.getAttribute("data-lux-visitor-description");e.addEventListener("blur",function(){v(TYPO3.settings.ajaxUrls["/lux/visitordescription"],{visitor:a,value:this.value},null)})}})},r=function(){var t=document.querySelector('[data-lux-container="detail"]');null!==t&&t.addEventListener("click",function(t){var e=t.target;if(null!==e.getAttribute("data-lux-linkmock-event")){var a=e.getAttribute("data-lux-linkmock-event"),n=document.querySelector('[data-lux-linkmock-link="'+a+'"]');null!==n&&n.click()}})};this.showDetailCallback=function(t){document.querySelector('[data-lux-container="detail"]').innerHTML=t.html;var e=document.querySelector('[data-lux-container="detailchart"]'),a=e.getContext("2d");new Chart(a,{type:"line",data:{datasets:[{label:e.getAttribute("data-chart-label"),data:e.getAttribute("data-chart-data").split(","),borderColor:"rgb(77, 231, 255)",lineTension:.5}],labels:e.getAttribute("data-chart-labels").split(",")},options:{legend:{display:!1,position:"right",labels:{fontSize:18}},scales:{yAxes:[{ticks:{beginAtZero:!0}}]}}})};var i=function(){null!==document.querySelector(".t3js-datetimepicker")&&require(["TYPO3/CMS/Backend/DateTimePicker"],function(t){t.initialize()})},l=function(){for(var t=document.querySelectorAll(".wizardform > fieldset"),e=document.querySelectorAll("[data-wizardform-gotostep]"),a=document.querySelectorAll(".wizard > a"),n=1;n<t.length;n++)t[n].style.display="none";for(var r=0;r<e.length;r++)e[r].addEventListener("click",function(e){e.preventDefault();var n=this.getAttribute("data-wizardform-gotostep");g(a,"current"),a[n-1].classList.add("current");for(var r=0;r<t.length;r++)t[r].style.display="none";t[n-1].style.display="block"})},o=function(){var t=document.querySelector('[data-lux-action-trigger="add"]');null!==t&&t.addEventListener("click",function(t){t.preventDefault();var e=document.querySelector('[data-lux-action-trigger="trigger"]').value,a=document.querySelector("[data-lux-triggers]").getAttribute("data-lux-triggers"),n=document.querySelector('[data-lux-action-trigger="conjunction"]').value;""!==e?v(TYPO3.settings.ajaxUrls["/lux/addtrigger"],{trigger:e,index:a,conjunction:n},"showHtmlInTriggerAreaCallback"):alert("Please choose a trigger first!")})};this.showHtmlInTriggerAreaCallback=function(t){var e=document.querySelector('[data-lux-container="triggerarea"]');null!==e&&(e.innerHTML+=t.html,d(),i())};var u=function(){var t=document.querySelector('[data-lux-action-action="add"]');null!==t&&t.addEventListener("click",function(t){t.preventDefault();var e=document.querySelector('[data-lux-action-action="action"]').value,a=document.querySelector("[data-lux-actions]").getAttribute("data-lux-actions");""!==e?v(TYPO3.settings.ajaxUrls["/lux/addaction"],{action:e,index:a},"showHtmlInActionAreaCallback"):alert("Please choose an action first!")})};this.showHtmlInActionAreaCallback=function(t){var e=document.querySelector('[data-lux-container="actionarea"]');null!==e&&(e.innerHTML+=t.html,s(),i())};var c=function(){for(var t=document.querySelectorAll('[data-lux-action="deleteWorkflow"]'),e=0;e<t.length;e++)t[e].addEventListener("click",function(t){t.preventDefault(),v(this.getAttribute("href"),{},null),x(this.closest("tr"))})},d=function(){var t=document.querySelector("[data-lux-triggers]").getAttribute("data-lux-triggers");document.querySelector("[data-lux-triggers]").setAttribute("data-lux-triggers",parseInt(t)+1)},s=function(){var t=document.querySelector("[data-lux-actions]").getAttribute("data-lux-actions");document.querySelector("[data-lux-actions]").setAttribute("data-lux-actions",parseInt(t)+1)},g=function(t,e){for(var a=0;a<t.length;a++)t[a].classList.remove(e)},v=function(t,a,n){if(void 0!==t&&""!==t){var r=new XMLHttpRequest;r.onreadystatechange=function(){4===this.readyState&&200===this.status&&null!==n&&e[n](JSON.parse(this.responseText))},r.open("POST",f(t,a),!0),r.send()}else console.log("No ajax URI given!")},f=function(t,e){for(var a in e)e.hasOwnProperty(a)&&(t+=t.indexOf("?")!==-1?"&":"?",t+=a+"="+encodeURIComponent(e[a]));return t},x=function(t){t.style.opacity=1,function e(){(t.style.opacity-=.1)<0?t.style.display="none":requestAnimationFrame(e)}()}}t(document).ready(function(){var a=new e(t);a.initialize()})});