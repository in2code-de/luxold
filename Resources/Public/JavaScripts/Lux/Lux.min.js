function LuxMain(){"use strict";var t="luxId",e="";this.lightboxInstance=null;var n=this;this.initialize=function(){w()&&(i(),p(),a(),u(),r())},this.closeLightbox=function(){null!==n.lightboxInstance&&n.lightboxInstance.close()};var i=function(){e=C()},a=function(){h()&&A(_(),g())},u=function(){for(var t=document.querySelectorAll("input, textarea, select, radio, check"),e=0;e<t.length;e++){var n=t[e];"password"!==n.type&&f(n)&&n.addEventListener("change",function(){c(this)})}},r=function(){for(var t=document.querySelectorAll("[data-lux-email4link-title]"),e=0;e<t.length;e++){var n=t[e];n.addEventListener("click",function(t){l(this,t)})}},l=function(t,e){e.preventDefault();var i=t.getAttribute("data-lux-email4link-title")||"",a=t.getAttribute("data-lux-email4link-text")||"",u=t.getAttribute("href"),r=document.querySelectorAll('[data-lux-container="email4link"]');if(r.length>0){var l=r[0].cloneNode(!0),c=l.innerHTML;c=c.replace("###TITLE###",i),c=c.replace("###TEXT###",a),c=c.replace("###HREF###",u),n.lightboxInstance=basicLightbox.create(c),n.lightboxInstance.element().querySelector('[data-lux-email4link="submit"]').addEventListener("click",function(e){o(this,e,t)}),n.lightboxInstance.show()}},o=function(t,e,i){e.preventDefault();var a=i.getAttribute("href"),u=i.getAttribute("data-lux-email4link-sendemail")||"false",r=n.lightboxInstance.element().querySelector('[data-lux-email4link="email"]').value;M(r)&&(S(),A(y(),{"tx_lux_fe[idCookie]":C(),"tx_lux_fe[email]":r,"tx_lux_fe[sendEmail]":"true"===u,"tx_lux_fe[href]":a}),"true"===u?(q(n.lightboxInstance.element().querySelector('[data-lux-email4link="form"]')),E(n.lightboxInstance.element().querySelector('[data-lux-email4link="successMessageSendEmail"]')),setTimeout(function(){n.lightboxInstance.close(),T()},2e3)):setTimeout(function(){n.lightboxInstance.close(),window.location=a,T()},500))},c=function(t){var e=s(t),n=t.value;A(k(),{"tx_lux_fe[idCookie]":C(),"tx_lux_fe[key]":e,"tx_lux_fe[value]":n})},f=function(t){return""!==s(t)},s=function(t){var e="",n=t.name,i=d();for(var a in i)if(i.hasOwnProperty(a))for(var u=0;u<i[a].length;u++)x(n,i[a][u])&&(e=a);return e},x=function(t,e){if(e.indexOf("*")!==-1){e=e.replace("*","");var n=t.indexOf(e)!==-1}else n=t===e;return n},d=function(){var t={};try{t=JSON.parse(window.luxFieldMappingConfiguration)}catch(e){console.log("Lux: No fieldmapping configuration given.")}return t},g=function(){return{"tx_lux_fe[idCookie]":C(),"tx_lux_fe[pageUid]":v(),"tx_lux_fe[referrer]":m(),"tx_lux_fe[languageUid]":b()}},h=function(){var t=!1,e=L();if(null!==e&&e.hasAttribute("data-lux-pagetracking")){var n=e.getAttribute("data-lux-pagetracking");t="1"===n}return t},v=function(){var t=0,e=L();if(null!==e&&e.hasAttribute("data-lux-pageuid")){var n=e.getAttribute("data-lux-pageuid");t=parseInt(n)}return t},m=function(){return encodeURIComponent(document.referrer)},b=function(){var t=0,e=L();if(null!==e&&e.hasAttribute("data-lux-languageuid")){var n=e.getAttribute("data-lux-languageuid");t=parseInt(n)}return t},p=function(){""===e&&(e=O(32),N(t,e))},_=function(){var t=L();return null!==t?t.getAttribute("data-lux-pagerequesturi"):""},k=function(){var t=L();return null!==t?t.getAttribute("data-lux-fieldlisteninguri"):""},y=function(){var t=L();return null!==t?t.getAttribute("data-lux-email4linkuri"):""},A=function(t,e){if(t){var n=new XMLHttpRequest;n.onreadystatechange=function(){if(4===this.readyState&&200===this.status){JSON.parse(this.responseText)}},n.open("POST",I(t,e),!0),n.send()}else console.log("No ajax URI given!")},I=function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t+=t.indexOf("?")!==-1?"&":"?",t+=n+"="+e[n]);return t},w=function(){return null!==L()},L=function(){return document.getElementById("lux_container")},S=function(){document.body.className+=" lux_waiting"},T=function(){document.body.classList.remove("lux_waiting")},q=function(t){t.style.display="none"},E=function(t){t.style.display="block"},O=function(t){for(var e="",n="abcdefghijklmnopqrstuvwxyz0123456789",i=0;i<t;i++)e+=n.charAt(Math.floor(Math.random()*n.length));return e},M=function(t){var e=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return e.test(t)},C=function(){return z(t)},N=function(t,e){var n=new Date,i=n.getTime();i+=31536e7,n.setTime(i),document.cookie=t+"="+e+"; expires="+n.toUTCString()+"; path=/"},z=function(t){for(var e=t+"=",n=document.cookie.split(";"),i=0;i<n.length;i++){for(var a=n[i];" "===a.charAt(0);)a=a.substring(1);if(0===a.indexOf(e))return a.substring(e.length,a.length)}return""}}var Lux=new window.LuxMain;Lux.initialize();